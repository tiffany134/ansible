---
- name: change pw on initial login
  vars_files:
    - ../c_test/passwd.json
  hosts: "{{ hostname }}"
  gather_facts: false
  tasks:
  - name: check if host is reachable
    wait_for:
      timeout: 0
    register: connect_rs
    ignore_unreachable: yes
    when: connect_rs | unreachable
  - name: change passwd
    expect:
      command: ssh root@{{ host_ip }}
      timeout: 20
      responses:
        "Password:": "{{ ansible_first_login_password }}"
        "UNIX password:": "{{ ansible_first_login_password }}"
        "New password:": "{{ ansible_password }}"
        "new password:": "{{ ansible_password }}"
        "\\~\\]\\$": exit
    register: status
